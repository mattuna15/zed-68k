00000400 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 06/06/2021 15:58:30

00000000  =00F00009                  1  ACIAC    EQU $F00009
00000000  =00F0000B                  2  ACIAD    EQU ACIAC+2
00000000                             3  
00000000  =00F20009                  4  ACIA2C    EQU $F20009
00000000  =00F2000B                  5  ACIA2D    EQU ACIA2C+2
00000000                             6  
00000000  =00002000                  7  INT_ON   EQU  $2000    ; BOTH, SET SUPERVISOR MODE, S=1
00000000  =00002700                  8  INT_OFF  EQU  $2700
00000000                             9  
00000000  =00000000                 10  RDRF    EQU 0           ; ACIAC Receive Data Register Full
00000000  =00000001                 11  TDRE    EQU 1           ; ACIAC Transmit Data Register Empty
00000000                            12  
00000000  =00000005                 13  SUPERVISOR_BIT EQU 5
00000000                            14  
00000000  =00000007                 15  TRACE_BIT EQU 7
00000000                            16  
00000000  =0000000D                 17  CR      EQU 13
00000000  =0000000A                 18  LF      EQU 10
00000000  =00000020                 19  SP      EQU 32
00000000  =00000008                 20  BS      EQU 8
00000000  =0000001E                 21  RS      EQU $1E
00000000  =0000001B                 22  ESC     EQU $1B
00000000                            23  
00000000  =0000E000                 24  SUPER_STACK   EQU $00E000   ; SUPER STACK TOP Address
00000000  =0000E000                 25  RAMBASE_INIT  EQU $00E000
00000000                            26  
00000000  =00F40041                 27  DATA_TX EQU $F40041
00000000  =00F40043                 28  DATA_RX EQU $F40043
00000000  =00F40045                 29  DATA_CTL EQU $F40045
00000000  =00F40046                 30  DATA_TX_SPACE EQU $F40046
00000000  =00F40048                 31  DATA_RX_COUNT EQU $F40048
00000000                            32  
00000000                            33  * TCP0_TxValid    => eth_ctl(5), --Transmit data valid
00000000                            34  *        TCP0_TxReady    => eth_ctl(3), --Transmit data ready
00000000                            35  *        TCP0_RxValid    => eth_ctl(4), --Receive data valid
00000000                            36  *        TCP0_RxReady    => eth_ctl(6)  --Receive data ready
00000000                            37  
00000000  =00000006                 38  TXVL EQU 6
00000000  =00000003                 39  TXRDY EQU 3
00000000  =00000002                 40  RXVLD EQU 2
00000000  =00000005                 41  RXRDY EQU 5
00000000                            42  
00000000                            43  *-- sdControl f4000a
00000000                            44  *-- 0 - din valid (a)
00000000                            45  *-- 1 - dout ack (a)
00000000                            46  * 2 - rden
00000000                            47  * 3 - wren
00000000                            48  *-- sdstatus f40009
00000000                            49  *-- 0 error
00000000                            50  *-- 1,2,3 - Error code
00000000                            51  *-- 4 - dout valid
00000000                            52  *-- 5 - Busy
00000000                            53  *-- 6,7 - card TYPE
00000000                            54  
00000000                            55  *-- sd_type:
00000000                            56  *-- 00 No card
00000000                            57  *-- 01 SD V1
00000000                            58  *-- 10 SD V2
00000000                            59  *-- 11 SDHC
00000000                            60  
00000000                            61  
00000000  =00F40000                 62  SDADDRESS EQU $F40000  ;LONG (32BIT)
00000000  =00F4000D                 63  SDDATA    EQU $F4000d  
00000000  =00F4000B                 64  SDCONTROL EQU $F4000b
00000000  =00F40009                 65  SDSTATUS  EQU $F40009
00000000                            66  
00000400                            67      ORG $0400
00000400                            68  **************************************************
00000400                            69  
00000400                            70  MAIN 
00000400                            71  
00000400  46FC 2700                 72      MOVE.W #INT_OFF,SR 
00000404  6100 0114                 73      BSR INIT_ACIA
00000408                            74     
00000408  47F9 000005F7             75      LEA.L TITLE1.L,A3     ; print START MESSAGE
0000040E  6100 01C2                 76      BSR PSTR
00000412                            77  
00000412                            78  *    lea AT.l,a3
00000412                            79  *    bsr wstr
00000412                            80      
00000412                            81  LOOP
00000412  6100 0184                 82      BSR WIN
00000416                            83      
00000416  60FA                      84      BRA LOOP
00000418                            85      
00000418                            86          
00000418                            87  CHECK_DRIVE   
00000418  47F9 00000625             88              LEA.L CHECKING.L,A3     ; print START MESSAGE
0000041E  6100 01B2                 89              BSR PSTR
00000422                            90              
00000422  49F9 00F40009             91              LEA.L SDSTATUS.L,A4
00000428                            92              
00000428  1214                      93              MOVE.b (A4), D1
0000042A  EC09                      94              LSR.B #$06, D1  ; GET BYTES 7,6 
0000042C                            95  
0000042C  B23C 0000                 96              CMP.B #$00,D1
00000430  6700 001A                 97              BEQ NO_CARD
00000434                            98              
00000434  B23C 0001                 99              CMP.B #$01,D1
00000438  6700 0022                100              BEQ CARD_V1
0000043C                           101              
0000043C  B23C 0002                102              CMP.B #$02,D1
00000440  6700 0028                103              BEQ CARD_V2
00000444                           104  
00000444  B23C 0003                105              CMP.B #$03,D1
00000448  6700 002E                106              BEQ CARD_HC   
0000044C                           107  
0000044C                           108  NO_CARD     
0000044C  47F9 00000632            109              LEA.L NOCARD.L,A3     ; print START MESSAGE
00000452  6100 017E                110              BSR PSTR 
00000456  4EF9 00A00BB4            111              JMP $A00BB4 ;EXIT BACK TO MON
0000045C                           112              ;BRA RETURN
0000045C                           113  CARD_V1
0000045C  47F9 0000063E            114              LEA.L CARDV1.L,A3     ; print START MESSAGE
00000462  6100 016E                115              BSR PSTR 
00000466  6000 001A                116              BRA RETURN
0000046A                           117  CARD_V2
0000046A  47F9 0000064A            118              LEA.L CARDV2.L,A3     ; print START MESSAGE
00000470  6100 0160                119              BSR PSTR 
00000474  6000 000C                120              BRA RETURN
00000478                           121  
00000478  47F9 00000656            122  CARD_HC     LEA.L CARDHC.L,A3     ; print START MESSAGE
0000047E  6100 0152                123              BSR PSTR        
00000482                           124              
00000482  4E75                     125  RETURN      RTS
00000484                           126  
00000484                           127  **************************************************
00000484                           128  
00000484                           129  
00000484                           130  READDRV     
00000484                           131  
00000484  47F9 00000662            132              LEA.L READING.L, A3     ; print START MESSAGE
0000048A  6100 0146                133              BSR PSTR  
0000048E                           134              
0000048E                           135              
0000048E  49F9 00F40009            136  BUSY        LEA.L SDSTATUS.L,A4
00000494  1214                     137              MOVE.b (A4), D1
00000496  B23C 00C0                138              CMP.b #$c0,D1
0000049A  6700 000E                139              BEQ RDEN               ; busy 0
0000049E                           140              
0000049E  47F9 0000066E            141              LEA.L BUSYSTR.L,A3     ; print START MESSAGE
000004A4  6100 012C                142              BSR PSTR 
000004A8                           143              
000004A8  60E4                     144              BRA.S BUSY
000004AA                           145              
000004AA  45F9 00F4000B            146  RDEN        LEA.L SDCONTROL.L,A2
000004B0  08D2 0002                147              BSET.b #02, (a2)
000004B4                           148   
000004B4                           149              for d5 = #1 to #512 do.s
000004B4  3A3C 0001                150s     MOVE.W  #1,D5
000004B8  6030                     151s     BRA.S   _20000001
000004BA                           152s _20000000
000004BA                           153              
000004BA  47F9 00000625            154              LEA.L CHECKING.L,A3     ; print START MESSAGE
000004C0  6100 0110                155              BSR PSTR
000004C4                           156              
000004C4  1214                     157  DOUT        MOVE.b (A4), D1
000004C6  0801 0004                158              BTST #4,D1
000004CA  67F8                     159              BEQ DOUT
000004CC                           160  
000004CC  4BF9 00F4000D            161  READ        LEA.l SDDATA.L,A5   
000004D2                           162              
000004D2  1015                     163              MOVE.b (A5), D0
000004D4  08D2 0001                164              BSET.b   #01, (a2)  ;ACK
000004D8  6100 0036                165              BSR OUT2X
000004DC  1214                     166  DAVAIL      MOVE.b (A4), D1
000004DE  0801 0004                167              BTST #4,D1
000004E2  66F8                     168              BNE DAVAIL
000004E4                           169              
000004E4  0892 0001                170              BCLR.b   #01, (a2)  ;ACK
000004E8                           171              
000004E8                           172              endf
000004E8  5245                     173s     ADD.W   #1,D5
000004EA                           174s _20000001
000004EA  BA7C 0200                175s     CMP.W   #512,D5
000004EE  6FCA                     176s     BLE.S   _20000000
000004F0                           177  
000004F0  0892 0002                178              BCLR.b  #02, (a2)  ; REMOVE RDEN
000004F4                           179              
000004F4  4E75                     180              RTS
000004F6                           181  
000004F6  1F00                     182  OUT1X        MOVE.B D0,-(SP)    ;SAVE D0
000004F8  C03C 000F                183               AND.B #$F,D0
000004FC  0600 0030                184               ADD.B #'0',D0
00000500  B03C 0039                185               CMP.B #'9',D0
00000504  6302                     186               BLS.S   OUT1X1
00000506  5E00                     187               ADD.B #7,D0
00000508  6100 002A                188  OUT1X1       BSR COUT
0000050C  101F                     189               MOVE.B (SP)+,D0    ;RESTORE D0
0000050E  4E75                     190               RTS
00000510                           191  
00000510  E818                     192  OUT2X        ROR.B #4,D0
00000512  61E2                     193               BSR.S OUT1X
00000514  E918                     194               ROL.B #4,D0
00000516  60DE                     195               BRA OUT1X
00000518                           196  
00000518  4E75                     197          RTS
0000051A                           198  **************************************************   
0000051A                           199     ; INIT ACIA
0000051A                           200  
0000051A  13FC 0003 00F00009       201  INIT_ACIA  MOVE.B #3,ACIAC.L   ; RESET ACIA
00000522  303C 0064                202             MOVE.W #100,D0
00000526  51C8 FFFE                203             DBRA  D0,*
0000052A  13FC 0015 00F00009       204             MOVE.B #$15,ACIAC.L   ; rts enabled 9600 8ne
00000532  4E75                     205             RTS
00000534                           206  
00000534  0839 0001 00F00009       207  COUT      BTST.B #TDRE,ACIAC.L
0000053C  67F6                     208            BEQ.S  COUT
0000053E  13C0 00F0000B            209            MOVE.B D0,ACIAD.L
00000544  4E75                     210            RTS
00000546                           211  
00000546                           212  
00000546  0839 0000 00F20009       213  CINS      BTST.B #RDRF,ACIA2C.L
0000054E  67F6                     214            BEQ.S  CINS
00000550  1039 00F2000B            215            MOVE.B ACIA2D.L,D0
00000556  4E75                     216            RTS
00000558                           217  
00000558                           218  
00000558  0839 0000 00F00009       219  CIN      BTST.B #RDRF,ACIAC.L
00000560  67F6                     220           BEQ.S  CIN
00000562  1039 00F0000B            221           MOVE.B ACIAD.L,D0
00000568  61CA                     222           BSR COUT
0000056A  4E75                     223           RTS
0000056C                           224  
0000056C                           225  *DATA_TX EQU $F40041
0000056C                           226  *DATA_RX EQU $F40043
0000056C                           227  *DATA_CTL EQU $F40045
0000056C                           228  *DATA_TX_SPACE EQU $F40046
0000056C                           229  *DATA_RX_COUNT EQU $F40048
0000056C                           230  *
0000056C                           231  ** TCP0_TxValid    => eth_ctl(5), --Transmit data valid
0000056C                           232  **        TCP0_TxReady    => eth_ctl(3), --Transmit data ready
0000056C                           233  **        TCP0_RxValid    => eth_ctl(4), --Receive data valid
0000056C                           234  **        TCP0_RxReady    => eth_ctl(6)  --Receive data ready
0000056C                           235  *
0000056C                           236  *TXVL EQU 5
0000056C                           237  *TXRDY EQU 3
0000056C                           238  *RXVLD EQU 4
0000056C                           239  *RXRDY EQU 6
0000056C                           240           
0000056C  0839 0003 00F40045       241  WOUT      BTST.B #TXRDY,DATA_CTL.L
00000574  6718                     242            BEQ.S  WRTS1
00000576  13C0 00F40041            243            MOVE.B D0,DATA_TX.L
0000057C                           244            
0000057C  08F9 0006 00F40045       245            BSET.B #TXVL,DATA_CTL.L
00000584                           246            
00000584  0839 0003 00F40045       247  WCHK      BTST.B #TXRDY,DATA_CTL.L
0000058C  66F6                     248            BNE.S  WCHK
0000058E                           249            
0000058E  08B9 0006 00F40045       250  WRTS1    BCLR.B #TXVL,DATA_CTL.L 
00000596  4E75                     251           RTS
00000598                           252            
00000598  0839 0002 00F40045       253  WIN      BTST.B #RXVLD,DATA_CTL.L
000005A0  671A                     254           BEQ.S  WRTS2
000005A2                           255           
000005A2  08F9 0005 00F40045       256           BSET.B #RXRDY,DATA_CTL.L
000005AA  1039 00F40043            257           MOVE.B DATA_RX.L,D0
000005B0  08B9 0005 00F40045       258           BCLR.B #RXRDY,DATA_CTL.L
000005B8                           259           
000005B8                           260  *         ADD.L #1, D1
000005B8                           261  *         
000005B8                           262  *         CMP #$2000,D1
000005B8                           263  *         BNE WRTS2
000005B8                           264  *         
000005B8                           265  *         MOVE.L #0, D1
000005B8                           266  *         MOVE.B #$63,D0
000005B8                           267           
000005B8  6100 FF7A                268           BSR COUT
000005BC                           269  
000005BC  4E75                     270  WRTS2    RTS
000005BE                           271  
000005BE  0839 0000 00F00009       272  WCIN     BTST.B #RDRF,ACIAC.L
000005C6  6708                     273           BEQ.S  WRTS3
000005C8  1039 00F0000B            274           MOVE.B ACIAD.L,D0
000005CE  619C                     275           BSR WOUT
000005D0  4E75                     276  WRTS3    RTS
000005D2                           277           
000005D2                           278  ; A3 POINTED TO FIRST BYTE
000005D2                           279  ; END WITH 0
000005D2                           280  
000005D2  101B                     281  PSTR     MOVE.B (A3)+,D0
000005D4  B03C 0000                282           CMP.B  #0,D0
000005D8  6706                     283           BEQ.S PSTR1
000005DA  6100 FF58                284           BSR COUT
000005DE  60F2                     285           BRA.S PSTR
000005E0                           286  
000005E0  4E75                     287  PSTR1    RTS
000005E2                           288  
000005E2  101B                     289  WSTR     MOVE.B (A3)+,D0
000005E4  B03C 0000                290           CMP.B  #0,D0
000005E8  6704                     291           BEQ.S WSTR1
000005EA                           292           
000005EA  6180                     293           BSR   WOUT
000005EC  60F4                     294           BRA.S WSTR
000005EE                           295  
000005EE  4E75                     296  WSTR1    RTS
000005F0                           297  
000005F0= 0D 0A 41 54 0D 0A 00     298  AT DC.B 13,10,'AT',13,10,0
000005F7= 0D 0A 46 6F 6E 74 20     299  TITLE1 DC.B 13,10,'Font Loader',13,10,0
          4C 6F 61 64 65 72 0D  
          0A 00                 
00000607= 0D 0A 4C 6F 61 64 69     302  WAITING DC.B 13,10,'Loading',13,10,0
          6E 67 0D 0A 00        
00000613= 0D 0A 42 79 74 65 20     304  RECVD DC.B 13,10,'Byte Received',13,10,0
          52 65 63 65 69 76 65  
          64 0D 0A 00           
00000625= 0D 0A 43 68 65 63 6B     307  CHECKING DC.B 13,10,'Checking',13,10,0
          69 6E 67 0D 0A 00     
00000632= 0D 0A 4E 6F 20 43 61     309  NOCARD DC.B 13,10,'No Card',13,10,0
          72 64 0D 0A 00        
0000063E= 0D 0A 43 61 72 64 20     311  CARDV1 DC.B 13,10,'Card V1',13,10,0
          56 31 0D 0A 00        
0000064A= 0D 0A 43 61 72 64 20     313  CARDV2 DC.B 13,10,'Card V2',13,10,0
          56 32 0D 0A 00        
00000656= 0D 0A 43 41 52 44 20     315  CARDHC DC.B 13,10,'CARD HC',13,10,0
          48 43 0D 0A 00        
00000662= 0D 0A 52 65 61 64 69     317  READING DC.B 13,10,'Reading',13,10,0
          6E 67 0D 0A 00        
0000066E= 0D 0A 42 75 73 79 0D     319  BUSYSTR DC.B 13,10,'Busy',13,10,0
          0A 00                 
00000677= 2E 00                    321  FULLSTOP DC.B '.',0
00000679                           322  
00000679                           323              END MAIN

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
ACIA2C              F20009
ACIA2D              F2000B
ACIAC               F00009
ACIAD               F0000B
AT                  5F0
BS                  8
BUSY                48E
BUSYSTR             66E
CARDHC              656
CARDV1              63E
CARDV2              64A
CARD_HC             478
CARD_V1             45C
CARD_V2             46A
CHECKING            625
CHECK_DRIVE         418
CIN                 558
CINS                546
COUT                534
CR                  D
DATA_CTL            F40045
DATA_RX             F40043
DATA_RX_COUNT       F40048
DATA_TX             F40041
DATA_TX_SPACE       F40046
DAVAIL              4DC
DOUT                4C4
ESC                 1B
FULLSTOP            677
INIT_ACIA           51A
INT_OFF             2700
INT_ON              2000
LF                  A
LOOP                412
MAIN                400
NOCARD              632
NO_CARD             44C
OUT1X               4F6
OUT1X1              508
OUT2X               510
PSTR                5D2
PSTR1               5E0
RAMBASE_INIT        E000
RDEN                4AA
RDRF                0
READ                4CC
READDRV             484
READING             662
RECVD               613
RETURN              482
RS                  1E
RXRDY               5
RXVLD               2
SDADDRESS           F40000
SDCONTROL           F4000B
SDDATA              F4000D
SDSTATUS            F40009
SP                  20
SUPERVISOR_BIT      5
SUPER_STACK         E000
TDRE                1
TITLE1              5F7
TRACE_BIT           7
TXRDY               3
TXVL                6
WAITING             607
WCHK                584
WCIN                5BE
WIN                 598
WOUT                56C
WRTS1               58E
WRTS2               5BC
WRTS3               5D0
WSTR                5E2
WSTR1               5EE
_20000000           4BA
_20000001           4EA
