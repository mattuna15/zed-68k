00002000 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 08/04/2021 20:40:18

00000000  =00F00009                  1  ACIAC    EQU $F00009
00000000  =00F0000B                  2  ACIAD    EQU ACIAC+2
00000000                             3  
00000000  =00F20009                  4  ACIA2C    EQU $F20009
00000000  =00F2000B                  5  ACIA2D    EQU ACIA2C+2
00000000                             6  
00000000  =00F30009                  7  ACIA3C    EQU $F30009
00000000  =00F3000B                  8  ACIA3D    EQU ACIA3C+2
00000000                             9  
00000000  =00002000                 10  INT_ON   EQU  $2000    ; BOTH, SET SUPERVISOR MODE, S=1
00000000  =00002700                 11  INT_OFF  EQU  $2700
00000000                            12  
00000000  =00000000                 13  RDRF    EQU 0           ; ACIAC Receive Data Register Full
00000000  =00000001                 14  TDRE    EQU 1           ; ACIAC Transmit Data Register Empty
00000000                            15  
00000000  =00000005                 16  SUPERVISOR_BIT EQU 5
00000000                            17  
00000000  =00000007                 18  TRACE_BIT EQU 7
00000000                            19  
00000000  =0000000D                 20  CR      EQU 13
00000000  =0000000A                 21  LF      EQU 10
00000000  =00000020                 22  SP      EQU 32
00000000  =00000008                 23  BS      EQU 8
00000000  =0000001E                 24  RS      EQU $1E
00000000  =0000001B                 25  ESC     EQU $1B
00000000                            26  
00000000  =0000E000                 27  SUPER_STACK   EQU $00E000   ; SUPER STACK TOP Address
00000000  =0000E000                 28  RAMBASE_INIT  EQU $00E000
00000000                            29  
00000000                            30  *-- sdControl f4000a
00000000                            31  *-- 0 - din valid (a)
00000000                            32  *-- 1 - dout ack (a)
00000000                            33  * 2 - rden
00000000                            34  * 3 - wren
00000000                            35  *-- sdstatus f40009
00000000                            36  *-- 0 error
00000000                            37  *-- 1,2,3 - Error code
00000000                            38  *-- 4 - dout valid
00000000                            39  *-- 5 - Busy
00000000                            40  *-- 6,7 - card TYPE
00000000                            41  
00000000                            42  *-- sd_type:
00000000                            43  *-- 00 No card
00000000                            44  *-- 01 SD V1
00000000                            45  *-- 10 SD V2
00000000                            46  *-- 11 SDHC
00000000                            47  
00000000                            48  
00000000  =00F40000                 49  SDADDRESS EQU $F40000  ;LONG (32BIT)
00000000  =00F4000D                 50  SDDATA    EQU $F4000d  
00000000  =00F4000B                 51  SDCONTROL EQU $F4000b
00000000  =00F40009                 52  SDSTATUS  EQU $F40009
00000000                            53  
00002000                            54      ORG $2000
00002000                            55  **************************************************
00002000                            56  
00002000                            57  MAIN 
00002000                            58  
00002000  46FC 2700                 59      MOVE.W #INT_OFF,SR 
00002004  6100 0122                 60      BSR INIT_ACIA
00002008                            61     
00002008  47F9 000021E5             62      LEA.L TITLE1.L,A3     ; print START MESSAGE
0000200E  6100 01A4                 63      BSR PSTR
00002012                            64  
00002012  47F9 000021DE             65      lea AT.l,a3
00002018  6100 01A8                 66      bsr wstr
0000201C                            67      
0000201C                            68  LOOP
0000201C  6100 016E                 69      BSR WIN
00002020                            70     
00002020  6100 017E                 71      BSR WCIN
00002024                            72      
00002024  60F6                      73      BRA LOOP
00002026                            74      
00002026                            75          
00002026                            76  CHECK_DRIVE   
00002026  47F9 00002213             77              LEA.L CHECKING.L,A3     ; print START MESSAGE
0000202C  6100 0186                 78              BSR PSTR
00002030                            79              
00002030  49F9 00F40009             80              LEA.L SDSTATUS.L,A4
00002036                            81              
00002036  1214                      82              MOVE.b (A4), D1
00002038  EC09                      83              LSR.B #$06, D1  ; GET BYTES 7,6 
0000203A                            84  
0000203A  B23C 0000                 85              CMP.B #$00,D1
0000203E  6700 001A                 86              BEQ NO_CARD
00002042                            87              
00002042  B23C 0001                 88              CMP.B #$01,D1
00002046  6700 0022                 89              BEQ CARD_V1
0000204A                            90              
0000204A  B23C 0002                 91              CMP.B #$02,D1
0000204E  6700 0028                 92              BEQ CARD_V2
00002052                            93  
00002052  B23C 0003                 94              CMP.B #$03,D1
00002056  6700 002E                 95              BEQ CARD_HC   
0000205A                            96  
0000205A                            97  NO_CARD     
0000205A  47F9 00002220             98              LEA.L NOCARD.L,A3     ; print START MESSAGE
00002060  6100 0152                 99              BSR PSTR 
00002064  4EF9 00A00BB4            100              JMP $A00BB4 ;EXIT BACK TO MON
0000206A                           101              ;BRA RETURN
0000206A                           102  CARD_V1
0000206A  47F9 0000222C            103              LEA.L CARDV1.L,A3     ; print START MESSAGE
00002070  6100 0142                104              BSR PSTR 
00002074  6000 001A                105              BRA RETURN
00002078                           106  CARD_V2
00002078  47F9 00002238            107              LEA.L CARDV2.L,A3     ; print START MESSAGE
0000207E  6100 0134                108              BSR PSTR 
00002082  6000 000C                109              BRA RETURN
00002086                           110  
00002086  47F9 00002244            111  CARD_HC     LEA.L CARDHC.L,A3     ; print START MESSAGE
0000208C  6100 0126                112              BSR PSTR        
00002090                           113              
00002090  4E75                     114  RETURN      RTS
00002092                           115  
00002092                           116  **************************************************
00002092                           117  
00002092                           118  
00002092                           119  READDRV     
00002092                           120  
00002092  47F9 00002250            121              LEA.L READING.L, A3     ; print START MESSAGE
00002098  6100 011A                122              BSR PSTR  
0000209C                           123              
0000209C                           124              
0000209C  49F9 00F40009            125  BUSY        LEA.L SDSTATUS.L,A4
000020A2  1214                     126              MOVE.b (A4), D1
000020A4  B23C 00C0                127              CMP.b #$c0,D1
000020A8  6700 000E                128              BEQ RDEN               ; busy 0
000020AC                           129              
000020AC  47F9 0000225C            130              LEA.L BUSYSTR.L,A3     ; print START MESSAGE
000020B2  6100 0100                131              BSR PSTR 
000020B6                           132              
000020B6  60E4                     133              BRA.S BUSY
000020B8                           134              
000020B8  45F9 00F4000B            135  RDEN        LEA.L SDCONTROL.L,A2
000020BE  08D2 0002                136              BSET.b #02, (a2)
000020C2                           137   
000020C2                           138              for d5 = #1 to #512 do.s
000020C2  3A3C 0001                139s     MOVE.W  #1,D5
000020C6  6030                     140s     BRA.S   _20000001
000020C8                           141s _20000000
000020C8                           142              
000020C8  47F9 00002213            143              LEA.L CHECKING.L,A3     ; print START MESSAGE
000020CE  6100 00E4                144              BSR PSTR
000020D2                           145              
000020D2  1214                     146  DOUT        MOVE.b (A4), D1
000020D4  0801 0004                147              BTST #4,D1
000020D8  67F8                     148              BEQ DOUT
000020DA                           149  
000020DA  4BF9 00F4000D            150  READ        LEA.l SDDATA.L,A5   
000020E0                           151              
000020E0  1015                     152              MOVE.b (A5), D0
000020E2  08D2 0001                153              BSET.b   #01, (a2)  ;ACK
000020E6  6100 0036                154              BSR OUT2X
000020EA  1214                     155  DAVAIL      MOVE.b (A4), D1
000020EC  0801 0004                156              BTST #4,D1
000020F0  66F8                     157              BNE DAVAIL
000020F2                           158              
000020F2  0892 0001                159              BCLR.b   #01, (a2)  ;ACK
000020F6                           160              
000020F6                           161              endf
000020F6  5245                     162s     ADD.W   #1,D5
000020F8                           163s _20000001
000020F8  BA7C 0200                164s     CMP.W   #512,D5
000020FC  6FCA                     165s     BLE.S   _20000000
000020FE                           166  
000020FE  0892 0002                167              BCLR.b  #02, (a2)  ; REMOVE RDEN
00002102                           168              
00002102  4E75                     169              RTS
00002104                           170  
00002104  1F00                     171  OUT1X        MOVE.B D0,-(SP)    ;SAVE D0
00002106  C03C 000F                172               AND.B #$F,D0
0000210A  0600 0030                173               ADD.B #'0',D0
0000210E  B03C 0039                174               CMP.B #'9',D0
00002112  6302                     175               BLS.S   OUT1X1
00002114  5E00                     176               ADD.B #7,D0
00002116  6100 002A                177  OUT1X1       BSR COUT
0000211A  101F                     178               MOVE.B (SP)+,D0    ;RESTORE D0
0000211C  4E75                     179               RTS
0000211E                           180  
0000211E  E818                     181  OUT2X        ROR.B #4,D0
00002120  61E2                     182               BSR.S OUT1X
00002122  E918                     183               ROL.B #4,D0
00002124  60DE                     184               BRA OUT1X
00002126                           185  
00002126  4E75                     186          RTS
00002128                           187  **************************************************   
00002128                           188     ; INIT ACIA
00002128                           189  
00002128  13FC 0003 00F00009       190  INIT_ACIA  MOVE.B #3,ACIAC.L   ; RESET ACIA
00002130  303C 0064                191             MOVE.W #100,D0
00002134  51C8 FFFE                192             DBRA  D0,*
00002138  13FC 0015 00F00009       193             MOVE.B #$15,ACIAC.L   ; rts enabled 9600 8ne
00002140  4E75                     194             RTS
00002142                           195  
00002142  0839 0001 00F00009       196  COUT      BTST.B #TDRE,ACIAC.L
0000214A  67F6                     197            BEQ.S  COUT
0000214C  13C0 00F0000B            198            MOVE.B D0,ACIAD.L
00002152  4E75                     199            RTS
00002154                           200  
00002154                           201  
00002154  0839 0000 00F20009       202  CINS      BTST.B #RDRF,ACIA2C.L
0000215C  67F6                     203            BEQ.S  CINS
0000215E  1039 00F2000B            204            MOVE.B ACIA2D.L,D0
00002164  4E75                     205            RTS
00002166                           206  
00002166                           207  
00002166  0839 0000 00F00009       208  CIN      BTST.B #RDRF,ACIAC.L
0000216E  67F6                     209           BEQ.S  CIN
00002170  1039 00F0000B            210           MOVE.B ACIAD.L,D0
00002176  61CA                     211           BSR COUT
00002178  4E75                     212           RTS
0000217A                           213           
0000217A  0839 0001 00F30009       214  WOUT      BTST.B #TDRE,ACIA3C.L
00002182  6706                     215            BEQ.S  WRTS1
00002184  13C0 00F3000B            216            MOVE.B D0,ACIA3D.L
0000218A  4E75                     217  WRTS1     RTS
0000218C                           218            
0000218C  0839 0000 00F30009       219  WIN      BTST.B #RDRF,ACIA3C.L
00002194  6708                     220           BEQ.S  WRTS2
00002196  1039 00F3000B            221           MOVE.B ACIA3D.L,D0
0000219C  61A4                     222           BSR COUT
0000219E  4E75                     223  WRTS2    RTS
000021A0                           224  
000021A0  0839 0000 00F00009       225  WCIN     BTST.B #RDRF,ACIAC.L
000021A8  6708                     226           BEQ.S  WRTS3
000021AA  1039 00F0000B            227           MOVE.B ACIAD.L,D0
000021B0  61C8                     228           BSR WOUT
000021B2  4E75                     229  WRTS3    RTS
000021B4                           230           
000021B4                           231  ; A3 POINTED TO FIRST BYTE
000021B4                           232  ; END WITH 0
000021B4                           233  
000021B4  101B                     234  PSTR     MOVE.B (A3)+,D0
000021B6  B03C 0000                235           CMP.B  #0,D0
000021BA  6704                     236           BEQ.S PSTR1
000021BC  6184                     237           BSR COUT
000021BE  60F4                     238           BRA.S PSTR
000021C0                           239  
000021C0  4E75                     240  PSTR1    RTS
000021C2                           241  
000021C2  101B                     242  WSTR     MOVE.B (A3)+,D0
000021C4  B03C 0000                243           CMP.B  #0,D0
000021C8  6712                     244           BEQ.S WSTR1
000021CA  0839 0001 00F30009       245  WOT      BTST.B #TDRE,ACIA3C.L
000021D2  67F6                     246           BEQ.S  WOT
000021D4  13C0 00F3000B            247           MOVE.B D0,ACIA3D.L
000021DA  60E6                     248           BRA.S WSTR
000021DC                           249  
000021DC  4E75                     250  WSTR1    RTS
000021DE                           251  
000021DE= 0D 0A 41 54 0D 0A 00     252  AT DC.B 13,10,'AT',13,10,0
000021E5= 0D 0A 46 6F 6E 74 20     253  TITLE1 DC.B 13,10,'Font Loader',13,10,0
          4C 6F 61 64 65 72 0D  
          0A 00                 
000021F5= 0D 0A 4C 6F 61 64 69     256  WAITING DC.B 13,10,'Loading',13,10,0
          6E 67 0D 0A 00        
00002201= 0D 0A 42 79 74 65 20     258  RECVD DC.B 13,10,'Byte Received',13,10,0
          52 65 63 65 69 76 65  
          64 0D 0A 00           
00002213= 0D 0A 43 68 65 63 6B     261  CHECKING DC.B 13,10,'Checking',13,10,0
          69 6E 67 0D 0A 00     
00002220= 0D 0A 4E 6F 20 43 61     263  NOCARD DC.B 13,10,'No Card',13,10,0
          72 64 0D 0A 00        
0000222C= 0D 0A 43 61 72 64 20     265  CARDV1 DC.B 13,10,'Card V1',13,10,0
          56 31 0D 0A 00        
00002238= 0D 0A 43 61 72 64 20     267  CARDV2 DC.B 13,10,'Card V2',13,10,0
          56 32 0D 0A 00        
00002244= 0D 0A 43 41 52 44 20     269  CARDHC DC.B 13,10,'CARD HC',13,10,0
          48 43 0D 0A 00        
00002250= 0D 0A 52 65 61 64 69     271  READING DC.B 13,10,'Reading',13,10,0
          6E 67 0D 0A 00        
0000225C= 0D 0A 42 75 73 79 0D     273  BUSYSTR DC.B 13,10,'Busy',13,10,0
          0A 00                 
00002265                           275              END MAIN

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
ACIA2C              F20009
ACIA2D              F2000B
ACIA3C              F30009
ACIA3D              F3000B
ACIAC               F00009
ACIAD               F0000B
AT                  21DE
BS                  8
BUSY                209C
BUSYSTR             225C
CARDHC              2244
CARDV1              222C
CARDV2              2238
CARD_HC             2086
CARD_V1             206A
CARD_V2             2078
CHECKING            2213
CHECK_DRIVE         2026
CIN                 2166
CINS                2154
COUT                2142
CR                  D
DAVAIL              20EA
DOUT                20D2
ESC                 1B
INIT_ACIA           2128
INT_OFF             2700
INT_ON              2000
LF                  A
LOOP                201C
MAIN                2000
NOCARD              2220
NO_CARD             205A
OUT1X               2104
OUT1X1              2116
OUT2X               211E
PSTR                21B4
PSTR1               21C0
RAMBASE_INIT        E000
RDEN                20B8
RDRF                0
READ                20DA
READDRV             2092
READING             2250
RECVD               2201
RETURN              2090
RS                  1E
SDADDRESS           F40000
SDCONTROL           F4000B
SDDATA              F4000D
SDSTATUS            F40009
SP                  20
SUPERVISOR_BIT      5
SUPER_STACK         E000
TDRE                1
TITLE1              21E5
TRACE_BIT           7
WAITING             21F5
WCIN                21A0
WIN                 218C
WOT                 21CA
WOUT                217A
WRTS1               218A
WRTS2               219E
WRTS3               21B2
WSTR                21C2
WSTR1               21DC
_20000000           20C8
_20000001           20F8
