00000400 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 06/06/2021 20:35:13

00000000  =00F00009                  1  ACIAC    EQU $F00009
00000000  =00F0000B                  2  ACIAD    EQU ACIAC+2
00000000                             3  
00000000  =00F20009                  4  ACIA2C    EQU $F20009
00000000  =00F2000B                  5  ACIA2D    EQU ACIA2C+2
00000000                             6  
00000000  =00002000                  7  INT_ON   EQU  $2000    ; BOTH, SET SUPERVISOR MODE, S=1
00000000  =00002700                  8  INT_OFF  EQU  $2700
00000000                             9  
00000000  =00000000                 10  RDRF    EQU 0           ; ACIAC Receive Data Register Full
00000000  =00000001                 11  TDRE    EQU 1           ; ACIAC Transmit Data Register Empty
00000000                            12  
00000000  =00000005                 13  SUPERVISOR_BIT EQU 5
00000000                            14  
00000000  =00000007                 15  TRACE_BIT EQU 7
00000000                            16  
00000000  =0000000D                 17  CR      EQU 13
00000000  =0000000A                 18  LF      EQU 10
00000000  =00000020                 19  SP      EQU 32
00000000  =00000008                 20  BS      EQU 8
00000000  =0000001E                 21  RS      EQU $1E
00000000  =0000001B                 22  ESC     EQU $1B
00000000                            23  
00000000  =0000E000                 24  SUPER_STACK   EQU $00E000   ; SUPER STACK TOP Address
00000000  =0000E000                 25  RAMBASE_INIT  EQU $00E000
00000000                            26  
00000000  =00F40041                 27  DATA_TX EQU $F40041
00000000  =00F40043                 28  DATA_RX EQU $F40043
00000000  =00F40045                 29  DATA_CTL EQU $F40045
00000000  =00F40046                 30  DATA_TX_SPACE EQU $F40046
00000000  =00F40048                 31  DATA_RX_COUNT EQU $F40048
00000000                            32  
00000000                            33  * TCP0_TxValid    => eth_ctl(6), --Transmit data valid
00000000                            34  *        TCP0_TxReady    => eth_ctl(3), --Transmit data ready
00000000                            35  *        TCP0_RxValid    => eth_ctl(2), --Receive data valid
00000000                            36  *        TCP0_RxReady    => eth_ctl(5)  --Receive data ready
00000000                            37  
00000000  =00000006                 38  TXVL EQU 6
00000000  =00000003                 39  TXRDY EQU 3
00000000  =00000002                 40  RXVLD EQU 2
00000000  =00000005                 41  RXRDY EQU 5
00000000                            42  
00000000                            43  *-- sdControl f4000a
00000000                            44  *-- 0 - din valid (a)
00000000                            45  *-- 1 - dout ack (a)
00000000                            46  * 2 - rden
00000000                            47  * 3 - wren
00000000                            48  *-- sdstatus f40009
00000000                            49  *-- 0 error
00000000                            50  *-- 1,2,3 - Error code
00000000                            51  *-- 4 - dout valid
00000000                            52  *-- 5 - Busy
00000000                            53  *-- 6,7 - card TYPE
00000000                            54  
00000000                            55  *-- sd_type:
00000000                            56  *-- 00 No card
00000000                            57  *-- 01 SD V1
00000000                            58  *-- 10 SD V2
00000000                            59  *-- 11 SDHC
00000000                            60  
00000000                            61  
00000000  =00F40000                 62  SDADDRESS EQU $F40000  ;LONG (32BIT)
00000000  =00F4000D                 63  SDDATA    EQU $F4000d  
00000000  =00F4000B                 64  SDCONTROL EQU $F4000b
00000000  =00F40009                 65  SDSTATUS  EQU $F40009
00000000                            66  
00000400                            67      ORG $0400
00000400                            68  **************************************************
00000400                            69  
00000400                            70  MAIN 
00000400                            71  
00000400  46FC 2700                 72      MOVE.W #INT_OFF,SR 
00000404  6100 0114                 73      BSR INIT_ACIA
00000408                            74     
00000408  47F9 000005EF             75      LEA.L TITLE1.L,A3     ; print START MESSAGE
0000040E  6100 01BA                 76      BSR PSTR
00000412                            77  
00000412                            78  *    lea AT.l,a3
00000412                            79  *    bsr wstr
00000412                            80      
00000412                            81  LOOP
00000412  6100 0144                 82      BSR CIN
00000416                            83      
00000416                            84  *    BSR WOUT
00000416                            85      
00000416  60FA                      86      BRA LOOP
00000418                            87      
00000418                            88          
00000418                            89  CHECK_DRIVE   
00000418  47F9 0000061D             90              LEA.L CHECKING.L,A3     ; print START MESSAGE
0000041E  6100 01AA                 91              BSR PSTR
00000422                            92              
00000422  49F9 00F40009             93              LEA.L SDSTATUS.L,A4
00000428                            94              
00000428  1214                      95              MOVE.b (A4), D1
0000042A  EC09                      96              LSR.B #$06, D1  ; GET BYTES 7,6 
0000042C                            97  
0000042C  B23C 0000                 98              CMP.B #$00,D1
00000430  6700 001A                 99              BEQ NO_CARD
00000434                           100              
00000434  B23C 0001                101              CMP.B #$01,D1
00000438  6700 0022                102              BEQ CARD_V1
0000043C                           103              
0000043C  B23C 0002                104              CMP.B #$02,D1
00000440  6700 0028                105              BEQ CARD_V2
00000444                           106  
00000444  B23C 0003                107              CMP.B #$03,D1
00000448  6700 002E                108              BEQ CARD_HC   
0000044C                           109  
0000044C                           110  NO_CARD     
0000044C  47F9 0000062A            111              LEA.L NOCARD.L,A3     ; print START MESSAGE
00000452  6100 0176                112              BSR PSTR 
00000456  4EF9 00A00BB4            113              JMP $A00BB4 ;EXIT BACK TO MON
0000045C                           114              ;BRA RETURN
0000045C                           115  CARD_V1
0000045C  47F9 00000636            116              LEA.L CARDV1.L,A3     ; print START MESSAGE
00000462  6100 0166                117              BSR PSTR 
00000466  6000 001A                118              BRA RETURN
0000046A                           119  CARD_V2
0000046A  47F9 00000642            120              LEA.L CARDV2.L,A3     ; print START MESSAGE
00000470  6100 0158                121              BSR PSTR 
00000474  6000 000C                122              BRA RETURN
00000478                           123  
00000478  47F9 0000064E            124  CARD_HC     LEA.L CARDHC.L,A3     ; print START MESSAGE
0000047E  6100 014A                125              BSR PSTR        
00000482                           126              
00000482  4E75                     127  RETURN      RTS
00000484                           128  
00000484                           129  **************************************************
00000484                           130  
00000484                           131  
00000484                           132  READDRV     
00000484                           133  
00000484  47F9 0000065A            134              LEA.L READING.L, A3     ; print START MESSAGE
0000048A  6100 013E                135              BSR PSTR  
0000048E                           136              
0000048E                           137              
0000048E  49F9 00F40009            138  BUSY        LEA.L SDSTATUS.L,A4
00000494  1214                     139              MOVE.b (A4), D1
00000496  B23C 00C0                140              CMP.b #$c0,D1
0000049A  6700 000E                141              BEQ RDEN               ; busy 0
0000049E                           142              
0000049E  47F9 00000666            143              LEA.L BUSYSTR.L,A3     ; print START MESSAGE
000004A4  6100 0124                144              BSR PSTR 
000004A8                           145              
000004A8  60E4                     146              BRA.S BUSY
000004AA                           147              
000004AA  45F9 00F4000B            148  RDEN        LEA.L SDCONTROL.L,A2
000004B0  08D2 0002                149              BSET.b #02, (a2)
000004B4                           150   
000004B4                           151              for d5 = #1 to #512 do.s
000004B4  3A3C 0001                152s     MOVE.W  #1,D5
000004B8  6030                     153s     BRA.S   _20000001
000004BA                           154s _20000000
000004BA                           155              
000004BA  47F9 0000061D            156              LEA.L CHECKING.L,A3     ; print START MESSAGE
000004C0  6100 0108                157              BSR PSTR
000004C4                           158              
000004C4  1214                     159  DOUT        MOVE.b (A4), D1
000004C6  0801 0004                160              BTST #4,D1
000004CA  67F8                     161              BEQ DOUT
000004CC                           162  
000004CC  4BF9 00F4000D            163  READ        LEA.l SDDATA.L,A5   
000004D2                           164              
000004D2  1015                     165              MOVE.b (A5), D0
000004D4  08D2 0001                166              BSET.b   #01, (a2)  ;ACK
000004D8  6100 0036                167              BSR OUT2X
000004DC  1214                     168  DAVAIL      MOVE.b (A4), D1
000004DE  0801 0004                169              BTST #4,D1
000004E2  66F8                     170              BNE DAVAIL
000004E4                           171              
000004E4  0892 0001                172              BCLR.b   #01, (a2)  ;ACK
000004E8                           173              
000004E8                           174              endf
000004E8  5245                     175s     ADD.W   #1,D5
000004EA                           176s _20000001
000004EA  BA7C 0200                177s     CMP.W   #512,D5
000004EE  6FCA                     178s     BLE.S   _20000000
000004F0                           179  
000004F0  0892 0002                180              BCLR.b  #02, (a2)  ; REMOVE RDEN
000004F4                           181              
000004F4  4E75                     182              RTS
000004F6                           183  
000004F6  1F00                     184  OUT1X        MOVE.B D0,-(SP)    ;SAVE D0
000004F8  C03C 000F                185               AND.B #$F,D0
000004FC  0600 0030                186               ADD.B #'0',D0
00000500  B03C 0039                187               CMP.B #'9',D0
00000504  6302                     188               BLS.S   OUT1X1
00000506  5E00                     189               ADD.B #7,D0
00000508  6100 002A                190  OUT1X1       BSR COUT
0000050C  101F                     191               MOVE.B (SP)+,D0    ;RESTORE D0
0000050E  4E75                     192               RTS
00000510                           193  
00000510  E818                     194  OUT2X        ROR.B #4,D0
00000512  61E2                     195               BSR.S OUT1X
00000514  E918                     196               ROL.B #4,D0
00000516  60DE                     197               BRA OUT1X
00000518                           198  
00000518  4E75                     199          RTS
0000051A                           200  **************************************************   
0000051A                           201     ; INIT ACIA
0000051A                           202  
0000051A  13FC 0003 00F00009       203  INIT_ACIA  MOVE.B #3,ACIAC.L   ; RESET ACIA
00000522  303C 0064                204             MOVE.W #100,D0
00000526  51C8 FFFE                205             DBRA  D0,*
0000052A  13FC 0015 00F00009       206             MOVE.B #$15,ACIAC.L   ; rts enabled 9600 8ne
00000532  4E75                     207             RTS
00000534                           208  
00000534  0839 0001 00F00009       209  COUT      BTST.B #TDRE,ACIAC.L
0000053C  67F6                     210            BEQ.S  COUT
0000053E  13C0 00F0000B            211            MOVE.B D0,ACIAD.L
00000544  4E75                     212            RTS
00000546                           213  
00000546                           214  
00000546  0839 0000 00F20009       215  CINS      BTST.B #RDRF,ACIA2C.L
0000054E  67F6                     216            BEQ.S  CINS
00000550  1039 00F2000B            217            MOVE.B ACIA2D.L,D0
00000556  4E75                     218            RTS
00000558                           219  
00000558                           220  
00000558  0839 0000 00F00009       221  CIN      BTST.B #RDRF,ACIAC.L
00000560  67F6                     222           BEQ.S  CIN
00000562  1039 00F0000B            223           MOVE.B ACIAD.L,D0
00000568  61CA                     224           BSR COUT
0000056A  6100 0004                225           BSR WOUT
0000056E  4E75                     226           RTS
00000570                           227  
00000570                           228  *DATA_TX EQU $F40041
00000570                           229  *DATA_RX EQU $F40043
00000570                           230  *DATA_CTL EQU $F40045
00000570                           231  *DATA_TX_SPACE EQU $F40046
00000570                           232  *DATA_RX_COUNT EQU $F40048
00000570                           233  *
00000570                           234  ** TCP0_TxValid    => eth_ctl(5), --Transmit data valid
00000570                           235  **        TCP0_TxReady    => eth_ctl(3), --Transmit data ready
00000570                           236  **        TCP0_RxValid    => eth_ctl(4), --Receive data valid
00000570                           237  **        TCP0_RxReady    => eth_ctl(6)  --Receive data ready
00000570                           238  *
00000570                           239  *TXVL EQU 5
00000570                           240  *TXRDY EQU 3
00000570                           241  *RXVLD EQU 4
00000570                           242  *RXRDY EQU 6
00000570                           243           
00000570  0839 0003 00F40045       244  WOUT      BTST.B #TXRDY,DATA_CTL.L
00000578  670E                     245            BEQ.S  WRTS1
0000057A                           246            
0000057A  13C0 00F40041            247            MOVE.B D0,DATA_TX.L 
00000580  08F9 0006 00F40045       248            BSET.B #TXVL,DATA_CTL.L
00000588                           249            
00000588                           250            
00000588  08B9 0006 00F40045       251  WRTS1    BCLR.B #TXVL,DATA_CTL.L 
00000590  4E75                     252           RTS
00000592                           253            
00000592  0839 0002 00F40045       254  WIN      BTST.B #RXVLD,DATA_CTL.L
0000059A  6718                     255           BEQ.S  WRTS2
0000059C                           256           
0000059C  08F9 0005 00F40045       257           BSET.B #RXRDY,DATA_CTL.L
000005A4  1039 00F40043            258           MOVE.B DATA_RX.L,D0
000005AA  08B9 0005 00F40045       259           BCLR.B #RXRDY,DATA_CTL.L
000005B2                           260           
000005B2  6180                     261           BSR COUT
000005B4                           262  
000005B4  4E75                     263  WRTS2    RTS
000005B6                           264  
000005B6  0839 0000 00F00009       265  WCIN     BTST.B #RDRF,ACIAC.L
000005BE  6708                     266           BEQ.S  WRTS3
000005C0  1039 00F0000B            267           MOVE.B ACIAD.L,D0
000005C6  61A8                     268           BSR WOUT
000005C8  4E75                     269  WRTS3    RTS
000005CA                           270           
000005CA                           271  ; A3 POINTED TO FIRST BYTE
000005CA                           272  ; END WITH 0
000005CA                           273  
000005CA  101B                     274  PSTR     MOVE.B (A3)+,D0
000005CC  B03C 0000                275           CMP.B  #0,D0
000005D0  6706                     276           BEQ.S PSTR1
000005D2  6100 FF60                277           BSR COUT
000005D6  60F2                     278           BRA.S PSTR
000005D8                           279  
000005D8  4E75                     280  PSTR1    RTS
000005DA                           281  
000005DA  101B                     282  WSTR     MOVE.B (A3)+,D0
000005DC  B03C 0000                283           CMP.B  #0,D0
000005E0  6704                     284           BEQ.S WSTR1
000005E2                           285           
000005E2  618C                     286           BSR   WOUT
000005E4  60F4                     287           BRA.S WSTR
000005E6                           288  
000005E6  4E75                     289  WSTR1    RTS
000005E8                           290  
000005E8= 0D 0A 41 54 0D 0A 00     291  AT DC.B 13,10,'AT',13,10,0
000005EF= 0D 0A 46 6F 6E 74 20     292  TITLE1 DC.B 13,10,'Font Loader',13,10,0
          4C 6F 61 64 65 72 0D  
          0A 00                 
000005FF= 0D 0A 4C 6F 61 64 69     295  WAITING DC.B 13,10,'Loading',13,10,0
          6E 67 0D 0A 00        
0000060B= 0D 0A 42 79 74 65 20     297  RECVD DC.B 13,10,'Byte Received',13,10,0
          52 65 63 65 69 76 65  
          64 0D 0A 00           
0000061D= 0D 0A 43 68 65 63 6B     300  CHECKING DC.B 13,10,'Checking',13,10,0
          69 6E 67 0D 0A 00     
0000062A= 0D 0A 4E 6F 20 43 61     302  NOCARD DC.B 13,10,'No Card',13,10,0
          72 64 0D 0A 00        
00000636= 0D 0A 43 61 72 64 20     304  CARDV1 DC.B 13,10,'Card V1',13,10,0
          56 31 0D 0A 00        
00000642= 0D 0A 43 61 72 64 20     306  CARDV2 DC.B 13,10,'Card V2',13,10,0
          56 32 0D 0A 00        
0000064E= 0D 0A 43 41 52 44 20     308  CARDHC DC.B 13,10,'CARD HC',13,10,0
          48 43 0D 0A 00        
0000065A= 0D 0A 52 65 61 64 69     310  READING DC.B 13,10,'Reading',13,10,0
          6E 67 0D 0A 00        
00000666= 0D 0A 42 75 73 79 0D     312  BUSYSTR DC.B 13,10,'Busy',13,10,0
          0A 00                 
0000066F= 2E 00                    314  FULLSTOP DC.B '.',0
00000671                           315  
00000671                           316              END MAIN

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
ACIA2C              F20009
ACIA2D              F2000B
ACIAC               F00009
ACIAD               F0000B
AT                  5E8
BS                  8
BUSY                48E
BUSYSTR             666
CARDHC              64E
CARDV1              636
CARDV2              642
CARD_HC             478
CARD_V1             45C
CARD_V2             46A
CHECKING            61D
CHECK_DRIVE         418
CIN                 558
CINS                546
COUT                534
CR                  D
DATA_CTL            F40045
DATA_RX             F40043
DATA_RX_COUNT       F40048
DATA_TX             F40041
DATA_TX_SPACE       F40046
DAVAIL              4DC
DOUT                4C4
ESC                 1B
FULLSTOP            66F
INIT_ACIA           51A
INT_OFF             2700
INT_ON              2000
LF                  A
LOOP                412
MAIN                400
NOCARD              62A
NO_CARD             44C
OUT1X               4F6
OUT1X1              508
OUT2X               510
PSTR                5CA
PSTR1               5D8
RAMBASE_INIT        E000
RDEN                4AA
RDRF                0
READ                4CC
READDRV             484
READING             65A
RECVD               60B
RETURN              482
RS                  1E
RXRDY               5
RXVLD               2
SDADDRESS           F40000
SDCONTROL           F4000B
SDDATA              F4000D
SDSTATUS            F40009
SP                  20
SUPERVISOR_BIT      5
SUPER_STACK         E000
TDRE                1
TITLE1              5EF
TRACE_BIT           7
TXRDY               3
TXVL                6
WAITING             5FF
WCIN                5B6
WIN                 592
WOUT                570
WRTS1               588
WRTS2               5B4
WRTS3               5C8
WSTR                5DA
WSTR1               5E6
_20000000           4BA
_20000001           4EA
