00002000 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 20/04/2021 20:57:27

00000000  =00F00009                  1  ACIAC    EQU $F00009
00000000  =00F0000B                  2  ACIAD    EQU ACIAC+2
00000000                             3  
00000000  =00F20009                  4  ACIA2C    EQU $F20009
00000000  =00F2000B                  5  ACIA2D    EQU ACIA2C+2
00000000                             6  
00000000  =00F30009                  7  ACIA3C    EQU $F30009
00000000  =00F3000B                  8  ACIA3D    EQU ACIA3C+2
00000000                             9  
00000000  =00002000                 10  INT_ON   EQU  $2000    ; BOTH, SET SUPERVISOR MODE, S=1
00000000  =00002700                 11  INT_OFF  EQU  $2700
00000000                            12  
00000000  =00000000                 13  RDRF    EQU 0           ; ACIAC Receive Data Register Full
00000000  =00000001                 14  TDRE    EQU 1           ; ACIAC Transmit Data Register Empty
00000000                            15  
00000000  =00000005                 16  SUPERVISOR_BIT EQU 5
00000000                            17  
00000000  =00000007                 18  TRACE_BIT EQU 7
00000000                            19  
00000000  =0000000D                 20  CR      EQU 13
00000000  =0000000A                 21  LF      EQU 10
00000000  =00000020                 22  SP      EQU 32
00000000  =00000008                 23  BS      EQU 8
00000000  =0000001E                 24  RS      EQU $1E
00000000  =0000001B                 25  ESC     EQU $1B
00000000                            26  
00000000                            27  
00000000                            28  *-- sdControl f4000a
00000000                            29  *-- 0 - din valid (a)
00000000                            30  *-- 1 - dout ack (a)
00000000                            31  * 2 - rden
00000000                            32  * 3 - wren
00000000                            33  *-- sdstatus f40009
00000000                            34  *-- 0 error
00000000                            35  *-- 1,2,3 - Error code
00000000                            36  *-- 4 - dout valid
00000000                            37  *-- 5 - Busy
00000000                            38  *-- 6,7 - card TYPE
00000000                            39  
00000000                            40  *-- sd_type:
00000000                            41  *-- 00 No card
00000000                            42  *-- 01 SD V1
00000000                            43  *-- 10 SD V2
00000000                            44  *-- 11 SDHC
00000000                            45  
00000000                            46  
00000000  =00F40022                 47  SDADDRESS EQU $F40022  ;LONG (32BIT)
00000000  =00F40027                 48  SDDATA    EQU $F40027  
00000000  =00F40021                 49  SDCONTROL EQU $F40021
00000000  =00F40020                 50  SDSTATUS  EQU $F40020
00000000                            51  
00000000                            52  
00002000                            53      ORG $2000
00002000                            54    
00002000                            55  
00002000                            56  **************************************************
00002000                            57  
00002000                            58  MAIN 
00002000                            59  
00002000  46FC 2700                 60      MOVE.W #INT_OFF,SR 
00002004  6100 011E                 61      BSR INIT_ACIA
00002008                            62     
00002008  47F9 000021E1             63      LEA.L TITLE1.L,A3     ; print START MESSAGE
0000200E  6100 01A0                 64      BSR PSTR
00002012                            65  
00002012                            66      ;CHECK SD CARD
00002012  6100 000C                 67      BSR CHECK_DRIVE
00002016                            68      
00002016                            69      ; READ SD CARD
00002016  6100 0076                 70      BSR READ_DRV
0000201A                            71      
0000201A                            72  
0000201A  4EF9 00A00BB4             73      JMP $A00BB4
00002020                            74  
00002020                            75  
00002020                            76      
00002020                            77  
00002020                            78  **************************************************            
00002020                            79  CHECK_DRIVE   
00002020  47F9 0000220F             80              LEA.L CHECKING.L,A3     ; print START MESSAGE
00002026  6100 0188                 81              BSR PSTR
0000202A                            82              
0000202A  49F9 00F40020             83              LEA.L SDSTATUS.L,A4
00002030                            84              
00002030  3214                      85              MOVE.W (A4), D1
00002032  E049                      86              LSR.W #8, D1  ; GET BYTES 7,6 
00002034  EC49                      87              LSR.W #6, D1  ; GET BYTES 7,6 
00002036                            88  
00002036  B23C 0000                 89              CMP.B #$00,D1
0000203A  6700 001A                 90              BEQ NO_CARD
0000203E                            91              
0000203E  B23C 0001                 92              CMP.B #$01,D1
00002042  6700 0022                 93              BEQ CARD_V1
00002046                            94              
00002046  B23C 0002                 95              CMP.B #$02,D1
0000204A  6700 0028                 96              BEQ CARD_V2
0000204E                            97  
0000204E  B23C 0003                 98              CMP.B #$03,D1
00002052  6700 002E                 99              BEQ CARD_HC   
00002056                           100  
00002056                           101  NO_CARD     
00002056  47F9 0000221C            102              LEA.L NOCARD.L,A3     ; print START MESSAGE
0000205C  6100 0152                103              BSR PSTR 
00002060  4EF9 00A00BB4            104              JMP $A00BB4 ;EXIT BACK TO MON
00002066                           105              ;BRA RETURN
00002066                           106  CARD_V1
00002066  47F9 00002228            107              LEA.L CARDV1.L,A3     ; print START MESSAGE
0000206C  6100 0142                108              BSR PSTR 
00002070  6000 001A                109              BRA RETURN
00002074                           110  CARD_V2
00002074  47F9 00002234            111              LEA.L CARDV2.L,A3     ; print START MESSAGE
0000207A  6100 0134                112              BSR PSTR 
0000207E  6000 000C                113              BRA RETURN
00002082                           114  
00002082  47F9 00002240            115  CARD_HC     LEA.L CARDHC.L,A3     ; print START MESSAGE
00002088  6100 0126                116              BSR PSTR        
0000208C                           117              
0000208C  4E75                     118  RETURN      RTS
0000208E                           119  
0000208E                           120  **************************************************
0000208E                           121  
0000208E                           122  
0000208E                           123  READ_DRV     
0000208E                           124  
0000208E  47F9 0000224C            125              LEA.L READING.L, A3     ; print START MESSAGE
00002094  6100 011A                126              BSR PSTR  
00002098                           127              
00002098                           128              
00002098  49F9 00F40020            129  BUSY        LEA.L SDSTATUS.L,A4
0000209E  3214                     130              MOVE.W (A4), D1
000020A0  B27C C000                131              CMP.W #$C000,D1
000020A4  6700 000E                132              BEQ RDEN               ; busy 0
000020A8                           133              
000020A8  47F9 00002258            134              LEA.L BUSYSTR.L,A3     ; print START MESSAGE
000020AE  6100 0100                135              BSR PSTR 
000020B2                           136              
000020B2  60E4                     137              BRA.S BUSY
000020B4                           138              
000020B4  45F9 00F40021            139  RDEN        LEA.L SDCONTROL.L,A2
000020BA  08D2 0002                140              BSET.b #02, (a2)
000020BE                           141   
000020BE                           142              for d5 = #1 to #512 do.s
000020BE  3A3C 0001                143s     MOVE.W  #1,D5
000020C2  6030                     144s     BRA.S   _20000001
000020C4                           145s _20000000
000020C4                           146              
000020C4  47F9 0000220F            147              LEA.L CHECKING.L,A3     ; print START MESSAGE
000020CA  6100 00E4                148              BSR PSTR
000020CE                           149              
000020CE  3214                     150  DOUT        MOVE.W (A4), D1
000020D0  0801 000C                151              BTST.L #12,D1
000020D4  67F8                     152              BEQ DOUT
000020D6                           153  
000020D6  4BF9 00F40027            154  READ        LEA.l SDDATA.L,A5   
000020DC                           155              
000020DC  1015                     156              MOVE.b (A5), D0
000020DE  08D2 0001                157              BSET.b   #01, (a2)  ;ACK
000020E2  6100 0036                158              BSR OUT2X
000020E6  3214                     159  DAVAIL      MOVE.W (A4), D1
000020E8  0801 000C                160              BTST #12,D1
000020EC  66F8                     161              BNE DAVAIL
000020EE                           162              
000020EE  0892 0001                163              BCLR.b   #01, (a2)  ;ACK
000020F2                           164              
000020F2                           165              endf
000020F2  5245                     166s     ADD.W   #1,D5
000020F4                           167s _20000001
000020F4  BA7C 0200                168s     CMP.W   #512,D5
000020F8  6FCA                     169s     BLE.S   _20000000
000020FA                           170  
000020FA  0892 0002                171              BCLR.b  #02, (a2)  ; REMOVE RDEN
000020FE                           172              
000020FE  4E75                     173              RTS
00002100                           174  
00002100  1F00                     175  OUT1X        MOVE.B D0,-(SP)    ;SAVE D0
00002102  C03C 000F                176               AND.B #$F,D0
00002106  0600 0030                177               ADD.B #'0',D0
0000210A  B03C 0039                178               CMP.B #'9',D0
0000210E  6302                     179               BLS.S   OUT1X1
00002110  5E00                     180               ADD.B #7,D0
00002112  6100 002A                181  OUT1X1       BSR COUT
00002116  101F                     182               MOVE.B (SP)+,D0    ;RESTORE D0
00002118  4E75                     183               RTS
0000211A                           184  
0000211A  E818                     185  OUT2X        ROR.B #4,D0
0000211C  61E2                     186               BSR.S OUT1X
0000211E  E918                     187               ROL.B #4,D0
00002120  60DE                     188               BRA OUT1X
00002122                           189  
00002122  4E75                     190          RTS
00002124                           191  **************************************************   
00002124                           192     ; INIT ACIA
00002124                           193  
00002124  13FC 0003 00F00009       194  INIT_ACIA  MOVE.B #3,ACIAC.L   ; RESET ACIA
0000212C  303C 0064                195             MOVE.W #100,D0
00002130  51C8 FFFE                196             DBRA  D0,*
00002134  13FC 0015 00F00009       197             MOVE.B #$15,ACIAC.L   ; rts enabled 9600 8ne
0000213C  4E75                     198             RTS
0000213E                           199  
0000213E  0839 0001 00F00009       200  COUT      BTST.B #TDRE,ACIAC.L
00002146  67F6                     201            BEQ.S  COUT
00002148  13C0 00F0000B            202            MOVE.B D0,ACIAD.L
0000214E  4E75                     203            RTS
00002150                           204  
00002150                           205  
00002150  0839 0000 00F20009       206  CINS      BTST.B #RDRF,ACIA2C.L
00002158  67F6                     207            BEQ.S  CINS
0000215A  1039 00F2000B            208            MOVE.B ACIA2D.L,D0
00002160  4E75                     209            RTS
00002162                           210  
00002162                           211  
00002162  0839 0000 00F00009       212  CIN      BTST.B #RDRF,ACIAC.L
0000216A  67F6                     213           BEQ.S  CIN
0000216C  1039 00F0000B            214           MOVE.B ACIAD.L,D0
00002172  61CA                     215           BSR COUT
00002174  4E75                     216           RTS
00002176                           217           
00002176  0839 0001 00F30009       218  WOUT      BTST.B #TDRE,ACIA3C.L
0000217E  6706                     219            BEQ.S  WRTS1
00002180  13C0 00F3000B            220            MOVE.B D0,ACIA3D.L
00002186  4E75                     221  WRTS1     RTS
00002188                           222            
00002188  0839 0000 00F30009       223  WIN      BTST.B #RDRF,ACIA3C.L
00002190  6708                     224           BEQ.S  WRTS2
00002192  1039 00F3000B            225           MOVE.B ACIA3D.L,D0
00002198  61A4                     226           BSR COUT
0000219A  4E75                     227  WRTS2    RTS
0000219C                           228  
0000219C  0839 0000 00F00009       229  WCIN     BTST.B #RDRF,ACIAC.L
000021A4  6708                     230           BEQ.S  WRTS3
000021A6  1039 00F0000B            231           MOVE.B ACIAD.L,D0
000021AC  61C8                     232           BSR WOUT
000021AE  4E75                     233  WRTS3    RTS
000021B0                           234           
000021B0                           235  ; A3 POINTED TO FIRST BYTE
000021B0                           236  ; END WITH 0
000021B0                           237  
000021B0  101B                     238  PSTR     MOVE.B (A3)+,D0
000021B2  B03C 0000                239           CMP.B  #0,D0
000021B6  6704                     240           BEQ.S PSTR1
000021B8  6184                     241           BSR COUT
000021BA  60F4                     242           BRA.S PSTR
000021BC                           243  
000021BC  4E75                     244  PSTR1    RTS
000021BE                           245  
000021BE  101B                     246  WSTR     MOVE.B (A3)+,D0
000021C0  B03C 0000                247           CMP.B  #0,D0
000021C4  6712                     248           BEQ.S WSTR1
000021C6  0839 0001 00F30009       249  WOT      BTST.B #TDRE,ACIA3C.L
000021CE  67F6                     250           BEQ.S  WOT
000021D0  13C0 00F3000B            251           MOVE.B D0,ACIA3D.L
000021D6  60E6                     252           BRA.S WSTR
000021D8                           253  
000021D8  4E75                     254  WSTR1    RTS
000021DA                           255  
000021DA= 0D 0A 41 54 0D 0A 00     256  AT DC.B 13,10,'AT',13,10,0
000021E1= 0D 0A 46 6F 6E 74 20     257  TITLE1 DC.B 13,10,'Font Loader',13,10,0
          4C 6F 61 64 65 72 0D  
          0A 00                 
000021F1= 0D 0A 4C 6F 61 64 69     260  WAITING DC.B 13,10,'Loading',13,10,0
          6E 67 0D 0A 00        
000021FD= 0D 0A 42 79 74 65 20     262  RECVD DC.B 13,10,'Byte Received',13,10,0
          52 65 63 65 69 76 65  
          64 0D 0A 00           
0000220F= 0D 0A 43 68 65 63 6B     265  CHECKING DC.B 13,10,'Checking',13,10,0
          69 6E 67 0D 0A 00     
0000221C= 0D 0A 4E 6F 20 43 61     267  NOCARD DC.B 13,10,'No Card',13,10,0
          72 64 0D 0A 00        
00002228= 0D 0A 43 61 72 64 20     269  CARDV1 DC.B 13,10,'Card V1',13,10,0
          56 31 0D 0A 00        
00002234= 0D 0A 43 61 72 64 20     271  CARDV2 DC.B 13,10,'Card V2',13,10,0
          56 32 0D 0A 00        
00002240= 0D 0A 43 41 52 44 20     273  CARDHC DC.B 13,10,'CARD HC',13,10,0
          48 43 0D 0A 00        
0000224C= 0D 0A 52 65 61 64 69     275  READING DC.B 13,10,'Reading',13,10,0
          6E 67 0D 0A 00        
00002258= 0D 0A 42 75 73 79 0D     277  BUSYSTR DC.B 13,10,'Busy',13,10,0
          0A 00                 
00002261                           279  
00002261                           280         END  MAIN

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
ACIA2C              F20009
ACIA2D              F2000B
ACIA3C              F30009
ACIA3D              F3000B
ACIAC               F00009
ACIAD               F0000B
AT                  21DA
BS                  8
BUSY                2098
BUSYSTR             2258
CARDHC              2240
CARDV1              2228
CARDV2              2234
CARD_HC             2082
CARD_V1             2066
CARD_V2             2074
CHECKING            220F
CHECK_DRIVE         2020
CIN                 2162
CINS                2150
COUT                213E
CR                  D
DAVAIL              20E6
DOUT                20CE
ESC                 1B
INIT_ACIA           2124
INT_OFF             2700
INT_ON              2000
LF                  A
MAIN                2000
NOCARD              221C
NO_CARD             2056
OUT1X               2100
OUT1X1              2112
OUT2X               211A
PSTR                21B0
PSTR1               21BC
RDEN                20B4
RDRF                0
READ                20D6
READING             224C
READ_DRV            208E
RECVD               21FD
RETURN              208C
RS                  1E
SDADDRESS           F40022
SDCONTROL           F40021
SDDATA              F40027
SDSTATUS            F40020
SP                  20
SUPERVISOR_BIT      5
TDRE                1
TITLE1              21E1
TRACE_BIT           7
WAITING             21F1
WCIN                219C
WIN                 2188
WOT                 21C6
WOUT                2176
WRTS1               2186
WRTS2               219A
WRTS3               21AE
WSTR                21BE
WSTR1               21D8
_20000000           20C4
_20000001           20F4
